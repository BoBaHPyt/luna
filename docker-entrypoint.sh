#!/bin/bash

DB_FILE="/app/luna.db"

# Проверяем, существует ли база данных
if [ ! -f "$DB_FILE" ]; then
    echo "=== База данных не найдена. Инициализация... ==="
    
    # Запускаем миграции Alembic
    echo "Запуск миграций Alembic..."
    alembic upgrade head
    
    # Генерируем тестовые данные (1000 компаний)
    echo "Генерация тестовых данных (1000 компаний)..."
    python data/seed_1000.py
    
    echo "=== Инициализация завершена ==="
else
    echo "=== База данных найдена. Пропускаем инициализацию ==="
fi

# Запускаем приложение
echo "Запуск FastAPI приложения..."
exec uvicorn src.main:app --host 0.0.0.0 --port 8000
